#!/usr/bin/env ruby

$LOAD_PATH << File.expand_path('../../lib', __FILE__)
$LOAD_PATH << File.expand_path('../../../../lib', __FILE__)

require 'slop'

opts = Slop.parse(help: true) do
  on 'host=', 'Hostname of server to connect to', default: 'localhost'
  on 'port=', 'Port to connect to',               default: '6667'
  on 'nick=', 'Nick (and username) to use',       default: 'frippery'
  on 'log=',  'Filename to log to (default: irc.log, stderr if blank)', default: 'irc.log'
end

if opts[:log] != ''
  $stderr.reopen File.open(opts[:log], 'a')
  $stderr.sync = true
end

begin
  require 'irc'
  IRC.run!(opts[:host], opts[:port], opts[:nick])
rescue
  if $stderr.is_a?(File)
    puts "Something went wrong. Check #{$stderr.path}."
  end

  raise
end

