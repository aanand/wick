#!/usr/bin/env ruby

require 'slop'

require 'irc_client'
require 'irc_client/client'
require 'irc_client/ui/raw'
require 'irc_client/ui/nice'
require 'irc_client/runner/socket'

opts = Slop.parse(help: true) do
  on 'host=', 'Hostname of server to connect to', default: 'localhost'
  on 'port=', 'Port to connect to',               default: '6667'
  on 'nick=', 'Nick (and username) to use',       default: 'frippery'
  on 'log=',  'Filename to log to (default: irc.log, stderr if blank)', default: 'irc.log'
end

if opts[:log] != ''
  $stderr.reopen File.open(opts[:log], 'a')
  $stderr.sync = true
end

client  = IRCClient::Client.new(opts[:nick])
ui      = IRCClient::UI::Nice.new(opts[:nick])
runner  = IRCClient::Runner::Socket.new(opts[:host], opts[:port], $stdin, $stdout)

IRCClient.start!(client, ui, runner)
